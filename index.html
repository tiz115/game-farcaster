<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>üåç World Flags Trivia</title>
<style>
:root{color-scheme:dark}*{box-sizing:border-box;margin:0;padding:0}body{background:linear-gradient(135deg,#0a0e13 0%,#1a1f2e 100%);color:#e7ecf0;font-family:system-ui,-apple-system,"Segoe UI",sans-serif;display:flex;flex-direction:column;align-items:center;min-height:100dvh;padding:20px}.wrap{width:min(900px,96vw);position:relative}.card{background:#12171b;border:1px solid #1f2a32;border-radius:14px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.35)}.overlay{position:fixed;inset:0;display:grid;place-items:center;background:rgba(8,11,14,.85);backdrop-filter:blur(4px);padding:16px;z-index:100}.hidden{display:none!important}h1{font-size:28px;font-weight:900;margin-bottom:12px;text-shadow:0 2px 10px rgba(56,189,248,0.5)}.muted{color:#9aa7b1;font-size:14px;line-height:1.4;margin-bottom:16px}.btn-primary{padding:14px 28px;background:linear-gradient(135deg,#ff8c42,#ff6b1a);color:#fff;border:none;border-radius:12px;font-weight:900;font-size:16px;cursor:pointer;box-shadow:0 6px 20px rgba(255,107,26,0.4);transition:all 0.2s;text-transform:uppercase;letter-spacing:0.5px}.btn-primary:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 25px rgba(255,107,26,0.5)}.btn-primary:disabled{opacity:0.6;cursor:not-allowed}#canvas{background:#0d1117;border:3px solid #1f2937;border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,0.5);max-width:100%;display:block;margin:20px auto}#controls{width:100%;margin-top:15px;display:flex;flex-direction:column;gap:15px}.stats-row{background:rgba(15,23,42,0.8);border:2px solid #1e293b;border-radius:12px;padding:15px;display:flex;align-items:center;justify-content:space-around;gap:15px;flex-wrap:wrap}.stat-item{display:flex;flex-direction:column;align-items:center;gap:5px}.stat-label{font-weight:700;font-size:12px;color:#94a3b8;text-transform:uppercase;letter-spacing:0.5px}.stat-value{font-size:20px;font-weight:900;color:#fbbf24}.question-panel{background:rgba(15,23,42,0.9);border:2px solid #1e293b;border-radius:12px;padding:20px}.question-title{font-size:18px;font-weight:700;color:#e7ecf0;text-align:center;margin-bottom:15px}.options-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px}.option-btn{padding:15px;background:linear-gradient(135deg,#3b82f6,#8b5cf6);color:#fff;border:none;border-radius:10px;font-weight:700;font-size:15px;cursor:pointer;transition:all 0.2s;text-align:center}.option-btn:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 6px 20px rgba(59,130,246,0.4)}.option-btn:disabled{cursor:not-allowed}.option-btn.correct{background:linear-gradient(135deg,#22c55e,#16a34a)}.option-btn.wrong{background:linear-gradient(135deg,#6b7280,#4b5563);opacity:0.5}.feedback{text-align:center;padding:12px;border-radius:8px;font-weight:700;margin-top:15px}.feedback.correct{background:rgba(34,197,94,0.2);color:#4ade80;border:2px solid #22c55e}.feedback.wrong{background:rgba(239,68,68,0.2);color:#f87171;border:2px solid #ef4444}#status{margin-top:15px;font-size:13px;line-height:1.5;background:#0f151a;border:1px solid #1f2a32;border-radius:10px;padding:12px}#status b{color:#cde7d8}#status .ok{color:#4ade80}#status .warn{color:#fbbf24}#status .err{color:#f87171}#status a{color:#86c6ff;text-decoration:none}#play-again{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);padding:16px 32px;background:linear-gradient(135deg,#ff8c42,#ff6b1a);color:#fff;border:none;border-radius:12px;font-weight:900;font-size:18px;cursor:pointer;box-shadow:0 10px 40px rgba(255,107,26,0.5);z-index:50}@media (max-width:720px){.options-grid{grid-template-columns:1fr}.stats-row{justify-content:space-between}}
</style>
</head>
<body>
<div class="wrap">
<div id="intro-overlay" class="overlay">
<div class="card">
<h1>üåç Play World Flags Trivia</h1>
<p class="muted">A small Base transfer is required to start playing (mobile & desktop supported).</p>
<div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
<div class="muted" style="font-size:12px">Change recipient/amount in code if needed.</div>
<button id="play" class="btn-primary">üí∞ Pay & Play</button>
</div>
<div id="status" class="hidden"></div>
</div>
</div>
<canvas id="canvas" width="900" height="500"></canvas>
<div id="controls">
<div class="stats-row">
<div class="stat-item"><span class="stat-label">Score</span><span class="stat-value" id="scoreDisplay">0</span></div>
<div class="stat-item"><span class="stat-label">Streak</span><span class="stat-value" id="streakDisplay" style="color:#ef4444">0üî•</span></div>
<div class="stat-item"><span class="stat-label">Lives</span><span class="stat-value" id="livesDisplay">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></div>
<div class="stat-item"><span class="stat-label">Correct</span><span class="stat-value" id="correctDisplay" style="color:#4ade80">0</span></div>
</div>
<div class="question-panel">
<h2 class="question-title">Which country does this flag belong to?</h2>
<div class="options-grid" id="optionsGrid"></div>
<div id="feedback" class="hidden"></div>
</div>
</div>
<button id="play-again" class="hidden">üí∞ Pay & Play Again</button>
</div>
<script type="module">
import{sdk}from'https://esm.sh/@farcaster/miniapp-sdk';sdk.actions.ready();const USE_BASE_SEPOLIA=!1,RECIPIENT="0x02212a875c56baE7AF27A5a389FD4e8A11442692",AMOUNT_ETH="0.00001",BASE_MAINNET={chainId:"0x2105",explorer:"https://basescan.org/tx/"},BASE_SEPOLIA={chainId:"0x14a34",explorer:"https://sepolia.basescan.org/tx/"},TARGET=USE_BASE_SEPOLIA?BASE_SEPOLIA:BASE_MAINNET,canvas=document.getElementById('canvas'),ctx=canvas.getContext('2d'),statusEl=document.getElementById('status'),playBtn=document.getElementById('play'),playAgainBtn=document.getElementById('play-again'),scoreDisplay=document.getElementById('scoreDisplay'),streakDisplay=document.getElementById('streakDisplay'),livesDisplay=document.getElementById('livesDisplay'),correctDisplay=document.getElementById('correctDisplay'),optionsGrid=document.getElementById('optionsGrid'),feedbackEl=document.getElementById('feedback'),showStatus=()=>statusEl.classList.remove('hidden'),addLine=e=>{showStatus();statusEl.insertAdjacentHTML('beforeend',`<div>${e}</div>`)},clearStatus=()=>statusEl.innerHTML='',disable=(e,t=!0)=>{e&&(e.disabled=t)};function parseEther(e){const[t,a=""]=(e+"").split('.'),s=(a+'0'.repeat(18)).slice(0,18);return'0x'+(BigInt(t)*10n**18n+BigInt(s)).toString(16)}async function getProvider(){try{const e=await sdk.wallet.getEthereumProvider();if(e)return e}catch{}return window.ethereum??null}async function ensureChain(e,t){const a=(await e.request({method:'eth_chainId'}))?.toLowerCase();if(a===t.toLowerCase())return;try{await e.request({method:'wallet_switchEthereumChain',params:[{chainId:t}]})}catch(a){if(4902===a?.code){await e.request({method:'wallet_addEthereumChain',params:[{chainId:t}]});await e.request({method:'wallet_switchEthereumChain',params:[{chainId:t}]})}else throw a}}async function requiredPayment(){clearStatus();addLine(`<b>Step 1:</b> Locating wallet provider‚Ä¶`);const e=await getProvider();if(!e){addLine(`<span class="err">No wallet available.</span> Open in Farcaster or enable a wallet.`);throw new Error('NO_PROVIDER')}addLine(`<span class="ok">Provider ready.</span>`);addLine(`<b>Step 2:</b> Requesting accounts‚Ä¶`);const[t]=await e.request({method:'eth_requestAccounts'});addLine(`<span class="ok">Account: ${t.slice(0,6)}‚Ä¶${t.slice(-4)}</span>`);addLine(`<b>Step 3:</b> Switching to Base${USE_BASE_SEPOLIA?' Sepolia':''}‚Ä¶`);await ensureChain(e,TARGET.chainId);addLine(`<span class="ok">On Base${USE_BASE_SEPOLIA?' Sepolia':''}.</span>`);addLine(`<b>Step 4:</b> Sending ${AMOUNT_ETH} ETH to ${RECIPIENT.slice(0,6)}‚Ä¶${RECIPIENT.slice(-4)}‚Ä¶`);const a=await e.request({method:'eth_sendTransaction',params:[{from:t,to:RECIPIENT,value:parseEther(AMOUNT_ETH)}]});addLine(`<span class="ok">TX sent.</span> <a target="_blank" rel="noopener" href="${TARGET.explorer}${a}">View on Basescan</a>`);return a}async function payThen(e,t){try{disable(t,!0);await requiredPayment();await e()}catch(e){console.warn('Payment gate blocked action:',e);addLine(`<span class="warn">Payment required. Please try again.</span>`)}finally{disable(t,!1)}}const FLAGS_DATABASE=[{country:'United States',colors:['#B22234','#FFFFFF','#3C3B6E'],type:'usa'},{country:'France',colors:['#0055A4','#FFFFFF','#EF4135'],type:'vertical'},{country:'Germany',colors:['#000000','#DD0000','#FFCE00'],type:'horizontal'},{country:'Italy',colors:['#009246','#FFFFFF','#CE2B37'],type:'vertical'},{country:'Spain',colors:['#AA151B','#F1BF00'],type:'spain'},{country:'Japan',colors:['#FFFFFF','#BC002D'],type:'japan'},{country:'Brazil',colors:['#009B3A','#FFDF00','#002776'],type:'brazil'},{country:'Canada',colors:['#FF0000','#FFFFFF'],type:'canada'},{country:'Mexico',colors:['#006847','#FFFFFF','#CE1126'],type:'vertical'},{country:'Argentina',colors:['#74ACDF','#FFFFFF'],type:'argentina'},{country:'Russia',colors:['#FFFFFF','#0039A6','#D52B1E'],type:'horizontal'},{country:'Netherlands',colors:['#AE1C28','#FFFFFF','#21468B'],type:'horizontal'},{country:'Sweden',colors:['#006AA7','#FECC00'],type:'sweden'},{country:'Switzerland',colors:['#FF0000','#FFFFFF'],type:'switzerland'},{country:'Poland',colors:['#FFFFFF','#DC143C'],type:'horizontal'},{country:'Greece',colors:['#0D5EAF','#FFFFFF'],type:'greece'},{country:'Portugal',colors:['#006600','#FF0000'],type:'vertical'},{country:'Belgium',colors:['#000000','#FDDA24','#EF3340'],type:'vertical'},{country:'Austria',colors:['#ED2939','#FFFFFF','#ED2939'],type:'horizontal'},{country:'Norway',colors:['#BA0C2F','#FFFFFF','#00205B'],type:'norway'}];let gameState={score:0,streak:0,lives:3,correct:0,total:0,currentQuestion:null,options:[],isAnswering:!1,gameActive:!1};function createFlagTexture(e){const t=document.createElement('canvas');t.width=600;t.height=400;const a=t.getContext('2d');a.fillStyle='#FFFFFF';a.fillRect(0,0,t.width,t.height);const{colors:s,type:r}=e;if('vertical'===r){const e=t.width/s.length;s.forEach((s,r)=>{a.fillStyle=s;a.fillRect(r*e,0,e,t.height)})}else if('horizontal'===r){const e=t.height/s.length;s.forEach((s,r)=>{a.fillStyle=s;a.fillRect(0,r*e,t.width,e)})}else if('usa'===r){for(let e=0;e<13;e++)a.fillStyle=e%2===0?'#B22234':'#FFFFFF',a.fillRect(0,e*(t.height/13),t.width,t.height/13);a.fillStyle='#3C3B6E';a.fillRect(0,0,.4*t.width,.538*t.height);a.fillStyle='#FFFFFF';for(let e=0;e<9;e++){const t=e%2===0?6:5,s=e%2===0?30:50;for(let r=0;r<t;r++)a.beginPath(),a.arc(s+40*r,20+23*e,8,0,2*Math.PI),a.fill()}}else if('japan'===r)a.fillStyle='#FFFFFF',a.fillRect(0,0,t.width,t.height),a.fillStyle='#BC002D',a.beginPath(),a.arc(t.width/2,t.height/2,100,0,2*Math.PI),a.fill();else if('canada'===r){a.fillStyle='#FF0000';a.fillRect(0,0,.25*t.width,t.height);a.fillRect(.75*t.width,0,.25*t.width,t.height);a.fillStyle='#FFFFFF';a.fillRect(.25*t.width,0,.5*t.width,t.height);a.fillStyle='#FF0000';const e=t.width/2,s=t.height/2;a.beginPath();a.moveTo(e,s-60);a.lineTo(e+20,s-20);a.lineTo(e+50,s-30);a.lineTo(e+25,s);a.lineTo(e+35,s+40);a.lineTo(e,s+20);a.lineTo(e-35,s+40);a.lineTo(e-25,s);a.lineTo(e-50,s-30);a.lineTo(e-20,s-20);a.closePath();a.fill()}else if('switzerland'===r){a.fillStyle='#FF0000';a.fillRect(0,0,t.width,t.height);a.fillStyle='#FFFFFF';const e=80,s=240;a.fillRect((t.width-e)/2,(t.height-s)/2,e,s);a.fillRect((t.width-s)/2,(t.height-e)/2,s,e)}else if('sweden'===r||'norway'===r){if(a.fillStyle=s[0],a.fillRect(0,0,t.width,t.height),'norway'===r)a.fillStyle='#FFFFFF',a.fillRect(.27*t.width,0,.13*t.width,t.height),a.fillRect(0,.37*t.height,t.width,.26*t.height),a.fillStyle='#00205B',a.fillRect(.3*t.width,0,.07*t.width,t.height),a.fillRect(0,.43*t.height,t.width,.14*t.height);else{a.fillStyle=s[1];a.fillRect(.3*t.width,0,.1*t.width,t.height);a.fillRect(0,.4*t.height,t.width,.2*t.height)}}else if('brazil'===r)a.fillStyle='#009B3A',a.fillRect(0,0,t.width,t.height),a.fillStyle='#FFDF00',a.beginPath(),a.moveTo(t.width/2,.1*t.height),a.lineTo(.9*t.width,t.height/2),a.lineTo(t.width/2,.9*t.height),a.lineTo(.1*t.width,t.height/2),a.closePath(),a.fill(),a.fillStyle='#002776',a.beginPath(),a.arc(t.width/2,t.height/2,80,0,2*Math.PI),a.fill();else if('argentina'===r)a.fillStyle=s[0],a.fillRect(0,0,t.width,.33*t.height),a.fillRect(0,.67*t.height,t.width,.33*t.height),a.fillStyle=s[1],a.fillRect(0,.33*t.height,t.width,.34*t.height),a.fillStyle='#FCBF49',a.beginPath(),a.arc(t.width/2,t.height/2,40,0,2*Math.PI),a.fill();else if('spain'===r)a.fillStyle=s[0],a.fillRect(0,0,t.width,.25*t.height),a.fillRect(0,.75*t.height,t.width,.25*t.height),a.fillStyle=s[1],a.fillRect(0,.25*t.height,t.width,.5*t.height);else if('greece'===r){for(let e=0;e<9;e++)a.fillStyle=e%2===0?s[0]:s[1],a.fillRect(0,e*(t.height/9),t.width,t.height/9);a.fillStyle=s[0];a.fillRect(0,0,.37*t.width,.55*t.height);a.fillStyle=s[1];a.fillRect(.14*t.width,0,.09*t.width,.55*t.height);a.fillRect(0,.22*t.height,.37*t.width,.11*t.height)}return t}let flagTexture=null,time=0;function drawFlag(){if(!flagTexture)return;const e=700,t=467,a=(canvas.width-e)/2,s=(canvas.height-t)/2;ctx.save();ctx.translate(a+e/2,s+t/2);ctx.rotate(.05*Math.sin(.5*time));ctx.translate(-e/2,-t/2);for(let a=0;a<e;a+=10){const e=5*Math.sin(.02*a+2*time);ctx.drawImage(flagTexture,a,0,10,t,a,e,10,t)}ctx.restore();time+=.016}function loadNewQuestion(){const e=FLAGS_DATABASE[Math.floor(Math.random()*FLAGS_DATABASE.length)],t=[];for(;t.length<3;){const a=FLAGS_DATABASE[Math.floor(Math.random()*FLAGS_DATABASE.length)];a.country!==e.country&&!t.includes(a.country)&&t.push(a.country)}const a=[...t,e.country].sort(()=>Math.random()-.5);gameState.currentQuestion=e;gameState.options=a;gameState.isAnswering=!1;flagTexture=createFlagTexture(e);feedbackEl.classList.add('hidden');optionsGrid.innerHTML='';a.forEach(e=>{const t=document.createElement('button');t.className='option-btn';t.textContent=e;t.onclick=()=>handleAnswer(e);optionsGrid.appendChild(t)})}function handleAnswer(e){if(gameState.isAnswering)return;gameState.isAnswering=!0;gameState.total++;const t=e===gameState.currentQuestion.country;if(Array.from(optionsGrid.children).forEach(e=>{e.disabled=!0;e.textContent===gameState.currentQuestion.country?e.classList.add('correct'):e.textContent!==e||e.classList.add('wrong')}),t){gameState.correct++;gameState.streak++;const e=10*(1+Math.floor(gameState.streak/5));gameState.score+=e;feedbackEl.textContent=`Correct! +${e} points`;feedbackEl.className='feedback correct';feedbackEl.classList.remove('hidden');setTimeout(loadNewQuestion,1200)}else{gameState.streak=0;gameState.lives--;feedbackEl.textContent=`Wrong! It was ${gameState.currentQuestion.country}`;feedbackEl.className='feedback wrong';feedbackEl.classList.remove('hidden');gameState.lives<=0?setTimeout(endGame,1500):setTimeout(loadNewQuestion,2e3)}updateDisplay()}function updateDisplay(){scoreDisplay.textContent=gameState.score;streakDisplay.textContent=gameState.streak>0?`${gameState.streak}üî•`:'0';livesDisplay.textContent='‚ù§Ô∏è'.repeat(gameState.lives)+'üñ§'.repeat(3-gameState.lives);correctDisplay.textContent=gameState.correct}function endGame(){gameState.gameActive=!1;ctx.fillStyle='rgba(0,0,0,0.7)';ctx.fillRect(0,0,canvas.width,canvas.height);ctx.fillStyle='#e7ecf0';ctx.font='bold 48px system-ui';ctx.textAlign='center';ctx.fillText('Game Over!',canvas.width/2,canvas.height/2-60);ctx.font='bold 32px system-ui';ctx.fillStyle='#fbbf24';ctx.fillText('Final Score: '+gameState.score,canvas.width/2,canvas.height/2-10);ctx.font='20px system-ui';ctx.fillStyle='#4ade80';ctx.fillText(`Correct: ${gameState.correct}/${gameState.total}`,canvas.width/2,canvas.height/2+30);ctx.font='18px system-ui';ctx.fillStyle='#a8b6c1';ctx.fillText('Click button below to play again',canvas.width/2,canvas.height/2+65);playAgainBtn.classList.remove('hidden');playAgainBtn.onclick=async e=>{e.preventDefault();await payThen(async()=>{playAgainBtn.classList.add('hidden');gameState={score:0,streak:0,lives:3,correct:0,total:0,currentQuestion:null,options:[],isAnswering:!1,gameActive:!0};loadNewQuestion();updateDisplay()},playAgainBtn)}}function gameLoop(){ctx.fillStyle='#0d1117';ctx.fillRect(0,0,canvas.width,canvas.height);drawFlag();gameState.gameActive&&requestAnimationFrame(gameLoop)}playBtn.addEventListener('click',e=>{e.preventDefault();payThen(()=>{document.getElementById('intro-overlay').classList.add('hidden');gameState.gameActive=!0;loadNewQuestion();updateDisplay();gameLoop()},playBtn)});window.addEventListener('error',e=>console.error('Error:',e.error||e));window.addEventListener('unhandledrejection',e=>console.error('Unhandled promise:',e.reason));
</script>
</body>
</html>
